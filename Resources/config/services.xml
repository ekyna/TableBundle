<?xml version="1.0" encoding="UTF-8" ?>
<container
        xmlns="http://symfony.com/schema/dic/services"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://symfony.com/schema/dic/services
                        http://symfony.com/schema/dic/services/services-1.0.xsd">

    <services>

        <!-- TableFactory -->
        <service id="table.factory" class="Ekyna\Component\Table\Factory">
            <argument type="service" id="table.registry"/>
            <argument type="service" id="form.factory"/>
        </service>

        <!-- Http foundation table type extension -->
        <service id="table.http_foundation.table_type_extension"
                 class="Ekyna\Component\Table\Bridge\Symfony\HttpFoundation\TableTypeExtension">
            <argument type="service" id="session.flash_bag"/>
            <argument type="service" id="translator"/>
            <tag name="table.type_extension" extended_type="Ekyna\Component\Table\Extension\Core\Type\TableType"/>
        </service>

        <!-- Session table type extension -->
        <service id="table.session.table_type_extension"
                 class="Ekyna\Component\Table\Bridge\Symfony\Session\TableTypeExtension">
            <argument type="service" id="session"/>
            <tag name="table.type_extension" extended_type="Ekyna\Component\Table\Extension\Core\Type\TableType"/>
        </service>

        <!-- Export table type extension -->
        <service id="table.export.table_type_extension"
                 class="Ekyna\Component\Table\Bridge\Symfony\Export\TableTypeExtension">
            <argument type="service" id="serializer"/>
            <tag name="table.type_extension" extended_type="Ekyna\Component\Table\Extension\Core\Type\TableType"/>
        </service>

        <!-- TODO Session storage table type extension -->

        <!-- Doctrine ORM extension -->
        <!-- TODO if doctrine ORM bundle is active (create a compiler pass) -->
        <service id="table.doctrine.orm.extension"
                 class="Ekyna\Component\Table\Bridge\Doctrine\ORM\DoctrineORMExtension">
            <argument type="service" id="doctrine"/>
        </service>

        <!-- DependencyInjectionExtension -->
        <service id="table.extension"
                 class="Ekyna\Component\Table\Bridge\Symfony\DependencyInjection\DependencyInjectionExtension"
                 public="false">
            <argument type="service" id="service_container"/>
            <!-- All services with tag "table.type" are inserted here by TablePass -->
            <argument type="collection"/>
            <!-- All services with tag "table.type_extension" are inserted here by TablePass -->
            <argument type="collection"/>
            <!-- All services with tag "table.column_type" are inserted here by TablePass -->
            <argument type="collection"/>
            <!-- All services with tag "table.column_type_extension" are inserted here by TablePass -->
            <argument type="collection"/>
            <!-- All services with tag "table.filter_type" are inserted here by TablePass -->
            <argument type="collection"/>
            <!-- All services with tag "table.filter_type_extension" are inserted here by TablePass -->
            <argument type="collection"/>
            <!-- All services with tag "table.action_type" are inserted here by TablePass -->
            <argument type="collection"/>
            <!-- All services with tag "table.action_type_extension" are inserted here by TablePass -->
            <argument type="collection"/>
            <!-- All services with tag "table.adapter" are inserted here by TablePass -->
            <argument type="collection"/>
        </service>

        <!-- ResolvedTypeFactory -->
        <service id="table.resolved_type_factory" class="Ekyna\Component\Table\ResolvedTypeFactory"/>

        <!-- TableRegistry -->
        <service id="table.registry" class="Ekyna\Component\Table\Registry">
            <argument type="collection">
                <argument type="service" id="table.doctrine.orm.extension"/>
                <argument type="service" id="table.extension"/>
            </argument>
            <argument type="service" id="table.resolved_type_factory"/>
        </service>

        <!-- Twig renderer -->
        <service id="table.twig.renderer"
                 class="Ekyna\Component\Table\Bridge\Twig\TwigRenderer"
                 public="false">
            <argument type="service" id="twig"/>
            <argument type="service" id="white_october_pagerfanta.view_factory"/>
        </service>

        <!-- Twig extension -->
        <service id="table.twig.extension" class="Ekyna\Component\Table\Bridge\Twig\TableExtension">
            <argument type="service" id="table.twig.renderer"/>
            <tag name="twig.extension"/>
        </service>
    </services>

</container>
